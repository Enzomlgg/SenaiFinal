@using System.IO
@using BarraByTech.Models.DTO
@inject BarraByTech.Services.ClienteService ClienteService
@inject IWebHostEnvironment Env

@model System.Collections.Generic.List<ProdutoDTO>

@{
    string nomeDaCategoriaForcado = ViewBag.NomeCategoria;
    string tituloExibicao = nomeDaCategoriaForcado;
    string termoBuscaBanner = nomeDaCategoriaForcado;

    List<string> bannersEncontrados = new List<string>();

    if (!string.IsNullOrEmpty(termoBuscaBanner))
    {
        try
        {
            string pastaBannersFisica = System.IO.Path.Combine(Env.WebRootPath, "Banners");

            if (Directory.Exists(pastaBannersFisica))
            {
                var todosArquivos = Directory.GetFiles(pastaBannersFisica);

                var arquivosFiltrados = todosArquivos
                    .Where(f =>
                    {
                        var nomeArquivo = System.IO.Path.GetFileName(f);
                        return nomeArquivo.StartsWith(termoBuscaBanner, StringComparison.OrdinalIgnoreCase)
                               && (nomeArquivo.EndsWith(".jpg") || nomeArquivo.EndsWith(".png") || nomeArquivo.EndsWith(".webp"));
                    })
                    .OrderBy(f => f)
                    .ToList();

                foreach (var arq in arquivosFiltrados)
                {
                    bannersEncontrados.Add($"/Banners/{System.IO.Path.GetFileName(arq)}");
                }
            }
        }
        catch { }
    }
}

<style>
    /* Estilos básicos para o carrossel de banners de categoria, se necessário */
    #carouselCategoria img {
        max-height: 400px;
        object-fit: cover;
    }

    /* Estilos para o card de produto, se não estiverem no CSS global */
    .card:hover {
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.15) !important;
    }

    .card .badge {
        z-index: 10;
    }

    .nav-links .btn-outline-primary {
        /* Design */
        border-radius: 0.5rem;
        padding: 8px 15px;
        transition: all 0.3s ease-in-out;
        /* Cores e Texto */
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        font-size: 0.95rem;
        text-transform: uppercase;
        color: #0d47a1 !important; /* Azul escuro */
        border: 2px solid #0d47a1 !important; /* Borda azul */
        background-color: transparent !important;
    }

        .nav-links .btn-outline-primary i {
            color: #ffae00; /* Laranja/Amarelo no ícone */
            font-size: 1.1rem;
        }

        .nav-links .btn-outline-primary:hover {
            /* Hover: Inverte as cores */
            color: #ffffff !important;
            background-color: #0d47a1 !important;
            border-color: #0d47a1 !important;
            box-shadow: 0 4px 8px rgba(0, 71, 161, 0.3); /* Sombra para profundidade */
            opacity: 1;
        }

            .nav-links .btn-outline-primary:hover i {
                color: #ffffff; /* Ícone branco no hover */
            }
</style>

<div class="nav-links">
    <div class="container d-flex justify-content-center gap-4 flex-wrap">
        @{
            var categorias = await ClienteService.GetCategorias();
        }

        @foreach (var categoria in categorias)
        {
            <a class="btn btn-outline-primary d-flex align-items-center gap-2"
               asp-controller="Categorias"
               asp-action="Detalhes"
               asp-route-id="@categoria.CategoriaId">
                <i class="bi bi-columns-gap"></i> @categoria.CategoriaNome
            </a>
        }
    </div>
</div>
@if (bannersEncontrados.Any())
{
    <div id="carouselCategoria" class="carousel slide mb-4 shadow-lg" data-bs-ride="carousel">
        <div class="carousel-indicators">
            @for (int i = 0; i < bannersEncontrados.Count; i++)
            {
                <button type="button" data-bs-target="#carouselCategoria" data-bs-slide-to="@i"
                        class="@(i == 0 ? "active" : "")" aria-current="true"></button>
            }
        </div>
        <div class="carousel-inner rounded-3">
            @for (int i = 0; i < bannersEncontrados.Count; i++)
            {
                <div class="carousel-item @(i == 0 ? "active" : "")" data-bs-interval="5000">
                    <img src="@bannersEncontrados[i]" class="d-block w-100"
                         alt="Banner Categoria @(i + 1)">
                </div>
            }
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselCategoria" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselCategoria" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Próximo</span>
        </button>
    </div>
}


<div class="container py-5">
    <h1 class="mb-4 fw-bold text-center">@tituloExibicao</h1>
    <hr class="mb-5" />

    @if (Model != null && Model.Any())
    {
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            @foreach (var produto in Model)
            {
                await Html.RenderPartialAsync("_ProdutoCardCategoria", produto);
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center py-4">
            <i class="bi bi-box-seam me-2"></i> Nenhum produto encontrado nesta categoria.
        </div>
    }
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>